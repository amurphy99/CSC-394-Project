{% extends 'base.html' %}

{% block header %}
  <h1> {% block title %} {{ this_user[1] }}'s Page {% endblock %} #{{ this_user[0] }} </h1>
{% endblock %}

{% block content %}

<!--
    ideas to add:
        * recent updates (display previous 3 shows/movies added)
        * statistics
            - movies watched
            - shows watched
            - average rating


--> 



<div class="user_page_VStack">
    
<<<<<<< Updated upstream
=======
    <div class="user-page-item"> 

        <!-- User Bio -->
        <div class="user_page_bio"> <p> {{ user_bio }} </p>  </div>

        <!-- This will create a pie chart comparing the number of similar and different movies watched by the current user and a friend -->
        <div id="userComparisonChart" class="user_pie_chart">
            <h4>Total movie count by genre</h4>
            <var id="pieData">{{user_Genres}}</var>
            <script src="https://d3js.org/d3.v4.js"></script>
            <script>//Creates pychart from inputted string
                pieInfo=document.getElementById('pieData')
                pieInfo.style.visibility='hidden';
                // function pieChart(){
            // d3.csv("https://raw.githubusercontent.com/brendenmm/TEMP/main/totalGenreCount.csv",function(data){
                // console.log(data)
                // delete data[""];
                // delete data[data.length-1];
                pieInfo=document.getElementById('pieData')
                pieInfo.style.visibility='hidden';
                // genreString='Foreign: 6, Drama: 4';
                genreString=pieInfo.textContent;
                genreArray=genreString.split(',')
                var width = 250
                height = 250
                margin = 20
                // genre=data.Genre;
                // d3.map(data, function(d){return(d.Genre)}).keys();
                // count=d3.map(data, function(d){return(d.Count)}).keys();
                // console.log(data[1].Count);
                // console.log(d3.entries(data))
                console.log(genreArray)

                // The radius of the piepchart
                var radius = Math.min(width, height) / 2 - margin

            //add chart to canvas
                var svg = d3.select("#userComparisonChart")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g")
                    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

                 data = {Horror: 6, Comedy: 3, Action:9, Documentary: 6}
                //  data={}
                 for(let i=0;i<genreArray.length;i++){
                    console.log(genreArray[i].split(':')[0])
                 data[genreArray[i].split(':')[0]]=genreArray[i].split(':')[1];
            }
                // console.log(data1)
                // set the colors
                var color = d3.scaleOrdinal()
                    .domain(data)
                    .range(["#377ba8", "#cae6f6","gray","#D3D3D3"])

                // Calculate the relative size of each section
                var pie = d3.pie()
                    .value(function(d) {return d.value; })
                    var enterData = pie(d3.entries(data))

                // graph each section of the pie chart
                svg
                    .selectAll('mySlices')
                    .data(enterData)
                    .enter()
                    .append('path')
                    .attr('d', d3.arc()
                    .innerRadius(0)
                    .outerRadius(radius))
                    .attr('fill', function(d){ return(color(d.data.key)) })
                        .attr("stroke", "black")
                        .style("stroke-width", "3px")
                    
                //Adds labels
                svg
                .selectAll('mySlices')
                .data(enterData)
                .enter()
                .append('text')
                .text(function(d){ return d.data.key+""})
                .attr("transform", function(d) { return "translate(" + d3.arc().innerRadius(0).outerRadius(radius).centroid(d) + ")";  })
                .style("text-anchor", "middle")
                .style("font-size", 12)
                // })
            // }
            </script>
>>>>>>> Stashed changes



    <!-- User Bio -->
    <div class="user_page_bio">
        <p> {{ user_bio }} </p>
    </div>



    <!-- Socials -->
    <div class="user_page_socials">
        <p> Friends:   {{ 25 }} </p>
        <p> Followers: {{ 12 }} </p>
        <button type="submit"> Add Friend </button>
        <button type="submit"> Edit Bio </button>
        <!-- button for user to edit Bio (No Functionality yet)-->
    </div>



    <!-- User Page Content -->
    <div class="user_page_HStack">

        <!-- User Statistics -->
        <div class="user-page-statistics">

            <p class="statistics-header"> Statistics </p>
        
            <ul class="user-statistics">
                {% for entry in statistics %}

                <div class="statistics-spacer">
                <li class="statistics-label"> {{ entry[0] }} <li>
                <li class="statistics-item" > {{ entry[1] }} <li>
                </div>

                {% endfor %}
            </ul>
        
        </div>

        <!-- Watch List Display -->
        <div class="user_watch_lists">
             <!-- This will create a pie chart comparing the number of similar and different movies watched by the current user and a friend -->
             <div id="userComparisonChart" class="user_pie_chart">
                <h4>Total movie count by genre</h4>
                <script src="https://d3js.org/d3.v4.js"></script>
                <script>
                    // function pieChart(){
                    var width = 250
                    height = 250
                    margin = 20

                    // The radius of the piepchart
                    var radius = Math.min(width, height) / 2 - margin

                   //add chart to canvas
                    var svg = d3.select("#userComparisonChart")
                        .append("svg")
                        .attr("width", width)
                        .attr("height", height)
                        .append("g")
                        .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

                    var data = {Horror: 6, Comedy: 3, Action:9, Documentary: 6}

                    // set the colors
                    var color = d3.scaleOrdinal()
                        .domain(data)
                        .range(["#377ba8", "#cae6f6","gray","#D3D3D3"])

                    // Calculate the relative size of each section
                    var pie = d3.pie()
                        .value(function(d) {return d.value; })
                        var enterData = pie(d3.entries(data))

                    // graph each section of the pie chart
                    svg
                        .selectAll('mySlices')
                        .data(enterData)
                        .enter()
                        .append('path')
                        .attr('d', d3.arc()
                        .innerRadius(0)
                        .outerRadius(radius))
                        .attr('fill', function(d){ return(color(d.data.key)) })
                            .attr("stroke", "black")
                            .style("stroke-width", "3px")
                        
                    //Adds labels
                    svg
                    .selectAll('mySlices')
                    .data(enterData)
                    .enter()
                    .append('text')
                    .text(function(d){ return d.data.key+""})
                    .attr("transform", function(d) { return "translate(" + d3.arc().innerRadius(0).outerRadius(radius).centroid(d) + ")";  })
                    .style("text-anchor", "middle")
                    .style("font-size", 12)


                // }
                </script>
            <div class="watch_lists_info">
                <h3> {{ this_user[1] }}'s Watch Lists </h3>
                <!-- 
                Only show the edit buttons if the one viewing this user page is logged in as the owner
                    the users id (if logged in):    {{ g.user[0]    }}
                    id of the user page:            {{ this_user[0] }}

                Later on I want to give the modal dialogue the user id so it can see the user's data (movies already in this list, etc)
                    The URL would need to be: /user/<userID>/modal
                    So:
                        hx-get="/user/{{g.user[0]}}/modal"
                -->
                {% if g.user is not none %}
                    {% if g.user[0]|int == this_user[0]|int %}
                    
                    <button 
                        hx-get="/user/modal" 
                        hx-target="#modals-here" 
                        hx-trigger="click"
                        hx-swap="innerHTML"
                        > Create New Watch List
                    </button>

                    {% endif %}
                {% endif %}

                

            </div>
            

            <div class="list_preview_wrapper">
                {% for watch_list in user_lists %}

                <div class="list_preview">
                    <h3> {{ watch_list[3] }} </h3>
                    <p>  {{ watch_list[4] }}  </p>
                    <p>  Created On: {{ watch_list[6] }}  </p>
                    <a href="{{ url_for('watch_list', listID=watch_list[0]) }}">View List</a>
                </div>

                {% endfor %}
            </div>
        </div>

        <!-- User Statistics -->
        <div class="user-page-statistics">

            <p class="statistics-header"> User Comparison </p>
        
            <ul class="user-statistics">
                {% for entry in user_comparison %}

                <div class="statistics-spacer">
                <li class="statistics-label"> {{ entry[0] }} <li>
                <li class="statistics-item" > {{ entry[1] }} <li>
                </div>

                {% endfor %}
               

            </div>
            </ul>
        
        </div>

    </div>  

    <div id="modals-here"> </div>

</div>

{% endblock %}